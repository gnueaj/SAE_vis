{
  "features_path": "data/master/features.parquet",
  "activation_examples_path": "data/master/activation_examples.parquet",
  "activation_embeddings_path": "data/master/activation_embeddings.parquet",
  "output_path": "data/master/interfeature_activation_similarity.parquet",
  "sae_id": "google--gemma-scope-9b-pt-res--layer_30--width_16k--average_l0_120",

  "description": "Configuration for calculating inter-feature activation similarity metrics between decoder-similar features with positional n-gram tracking for visualization",

  "processing_parameters": {
    "top_n_decoder_similar": 4,
    "num_quantiles": 4,
    "samples_per_quantile": 2,
    "embedding_window_size": 32,
    "char_ngram_window_size": 3,
    "word_ngram_window_size": 11,
    "char_ngram_sizes": [2, 3, 4, 5],
    "word_ngram_sizes": [1, 2, 3],
    "semantic_threshold": 0.3,
    "char_jaccard_threshold": 0.4,
    "word_jaccard_threshold": 0.4
  },

  "processing_notes": {
    "expected_features": 16384,
    "processing_strategy": "decoder_similarity_based_pairing",
    "handle_insufficient_examples": "use_all_available",
    "embeddings_source": "pre_computed_from_4_act_embeddings.py",
    "dependencies": [
      "3_features_parquet.py must be run first (for decoder_similarity field)",
      "4_act_embeddings.py must be run first (for pre-computed embeddings)",
      "5_act_similarity.py must be run first (for activation_examples.parquet)"
    ],
    "primary_key_fields": [
      "feature_id",
      "sae_id"
    ],
    "comparison_strategy": "cross_feature_pairwise",
    "pairwise_computation": "8 main examples Ã— 8 selected examples with pattern filtering and position tracking",
    "version": "4.0",
    "architecture": "dual_ngram_with_position_tracking",
    "pattern_classification": "semantic and/or lexical (pairs can be in both lists)",
    "position_tracking": "char_offset and token positions stored per prompt_id for frontend highlighting"
  },

  "schema_info": {
    "table_name": "interfeature_activation_similarity",
    "version": "4.0",
    "field_descriptions": {
      "feature_id": "Main feature ID (0-16383)",
      "sae_id": "SAE model identifier",
      "semantic_pairs": "Feature pairs with semantic similarity above threshold (pattern=Semantic)",
      "lexical_pairs": "Feature pairs with lexical similarity above threshold (pattern=Lexical)",
      "similar_feature_id": "ID of the decoder-similar feature being compared",
      "decoder_similarity": "Decoder weight cosine similarity from features.parquet",
      "pattern_type": "Classification: Semantic or Lexical (pairs can be in both lists)",
      "semantic_similarity": "Average pairwise cosine similarity of embeddings",
      "char_jaccard": "Character-level n-gram Jaccard similarity",
      "word_jaccard": "Word-level n-gram Jaccard similarity",
      "main_prompt_ids": "List of prompt IDs analyzed from main feature (max 8)",
      "similar_prompt_ids": "List of prompt IDs analyzed from similar feature (max 8)",
      "num_comparisons": "Total number of pairwise comparisons performed",
      "max_char_ngram": "Most frequent character n-gram text",
      "max_char_ngram_size": "Size of most frequent character n-gram",
      "max_word_ngram": "Most frequent word n-gram text",
      "max_word_ngram_size": "Size of most frequent word n-gram",
      "main_char_ngram_positions": "List of {prompt_id, positions: [{token_position, char_offset}]} for main feature",
      "similar_char_ngram_positions": "List of {prompt_id, positions: [{token_position, char_offset}]} for similar feature",
      "main_word_ngram_positions": "List of {prompt_id, positions: [token_positions]} for main feature",
      "similar_word_ngram_positions": "List of {prompt_id, positions: [token_positions]} for similar feature"
    },
    "notes": {
      "v4_changes": "Removed both_pairs list. Pairs meeting both conditions are now added to both semantic_pairs and lexical_pairs. Added position tracking fields for frontend visualization.",
      "frontend_integration": "Frontend joins this data with activation_display.parquet on feature_id to get full example data. Position fields enable precise n-gram highlighting."
    }
  }
}
