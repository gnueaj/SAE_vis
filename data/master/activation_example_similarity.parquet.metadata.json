{
  "created_at": "2025-11-07T19:54:56.642978",
  "script_version": "1.0",
  "sae_id": "google--gemma-scope-9b-pt-res--layer_30--width_16k--average_l0_120",
  "total_rows": 16384,
  "schema": {
    "feature_id": "UInt32",
    "sae_id": "Categorical",
    "prompt_ids_for_calculation": "List(Int64)",
    "prompt_ids_for_display": "List(Int64)",
    "num_total_activations": "UInt32",
    "avg_pairwise_semantic_similarity": "Float32",
    "top_char_ngrams": "List(Struct([Field('ngram', Utf8), Field('ngram_size', Int64), Field('count', Int64), Field('occurrences', List(Struct([Field('prompt_id', Int64), Field('token_position', Int64), Field('token_text', Utf8), Field('char_offset', Int64), Field('ngram_size', Int64)])))]))",
    "top_word_ngrams": "List(Struct([Field('ngram', Utf8), Field('ngram_size', Int64), Field('count', Int64), Field('occurrences', List(Struct([Field('prompt_id', Int64), Field('start_position', Int64), Field('ngram_size', Int64)])))]))",
    "top_char_ngram": "Struct([Field('ngram', Utf8), Field('ngram_size', Int64), Field('count', Int64), Field('occurrences', List(Struct([Field('prompt_id', Int64), Field('token_position', Int64), Field('token_text', Utf8), Field('char_offset', Int64), Field('ngram_size', Int64)])))])",
    "top_word_ngram": "Struct([Field('ngram', Utf8), Field('ngram_size', Int64), Field('count', Int64), Field('occurrences', List(Struct([Field('prompt_id', Int64), Field('start_position', Int64), Field('ngram_size', Int64)])))])",
    "top_char_ngram_jaccard": "Float64",
    "top_word_ngram_jaccard": "Float64",
    "quantile_boundaries": "List(Float64)",
    "ngram_jaccard_similarity": "List(Float64)"
  },
  "processing_stats": {
    "features_processed": 16384,
    "features_with_no_activations": 1,
    "features_with_insufficient_examples": 1723,
    "total_examples_analyzed": 254803,
    "semantic_similarity_computed": 16382,
    "ngram_analysis_computed": 16383,
    "ngram_jaccard_computed": 16382
  },
  "result_stats": {
    "features_with_similarity": 16382,
    "mean_semantic_similarity": 0.2497396022704455,
    "mean_jaccard_similarity": 0.4806683225964385,
    "mean_examples_for_calculation": 15.55194091796875,
    "mean_examples_for_display": 7.97216796875
  },
  "config_used": {
    "activation_examples_path": "data/master/activation_examples.parquet",
    "activation_embeddings_path": "data/master/activation_embeddings.parquet",
    "output_path": "data/master/activation_example_similarity.parquet",
    "sae_id": "google--gemma-scope-9b-pt-res--layer_30--width_16k--average_l0_120",
    "processing_parameters": {
      "num_quantiles": 4,
      "examples_per_quantile": 4,
      "target_examples_per_feature": 16,
      "token_window_size": 32,
      "char_ngram_window_size": 1,
      "word_ngram_window_size": 11,
      "ngram_sizes": [
        2,
        3,
        4
      ],
      "min_ngram_occurrences": 2,
      "examples_for_position_tracking": 8,
      "position_samples_per_quantile": 2,
      "char_ngram_sizes": [
        2,
        3,
        4,
        5
      ],
      "word_ngram_sizes": [
        1,
        2,
        3
      ]
    },
    "description": "Configuration for calculating activation example similarity metrics (semantic similarity and n-grams) using pre-computed embeddings",
    "processing_notes": {
      "expected_features": 16384,
      "processing_strategy": "quantile_based_sampling",
      "handle_insufficient_examples": "use_all_available",
      "embeddings_source": "pre_computed_from_4_act_embeddings.py",
      "dependencies": [
        "4_act_embeddings.py must be run first"
      ],
      "primary_key_fields": [
        "feature_id",
        "sae_id"
      ]
    },
    "schema_info": {
      "table_name": "activation_example_similarity",
      "version": "3.0",
      "field_descriptions": {
        "feature_id": "SAE feature index (0-16383)",
        "sae_id": "SAE model identifier",
        "prompt_ids_analyzed": "List of prompt IDs selected for analysis",
        "num_total_activations": "Total number of activation examples for this feature",
        "avg_pairwise_semantic_similarity": "Average cosine similarity across all pairs of 32-token windows",
        "top_char_ngrams": "Most frequent character n-gram per size (2-5) extracted from individual tokens with '\u2581' prefix stripped (3-token window around max activation)",
        "top_word_ngrams": "Most frequent word-level n-gram per size (1-3) reconstructed from subword tokens (11-token window around max activation)",
        "top_char_ngram": "Overall most frequent character n-gram (across all sizes 2-5) with all occurrence positions including char_offset within token (3-token window)",
        "top_word_ngram": "Overall most frequent word n-gram (across all sizes 1-3) with all occurrence positions (11-token window)",
        "top_char_ngram_jaccard": "Pairwise Jaccard similarity for the top character n-gram (single value)",
        "top_word_ngram_jaccard": "Pairwise Jaccard similarity for the top word n-gram (single value)",
        "quantile_boundaries": "Activation value thresholds for the 4 quantiles [q1, q2, q3]",
        "ngram_jaccard_similarity": "Average pairwise Jaccard similarity [2gram, 3gram, 4gram, 5gram] using per-token character extraction (legacy)"
      }
    }
  }
}